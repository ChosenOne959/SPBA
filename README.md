# SPBA软件简介
这是一个基于AirSim平台搭建的具有高物理还原度，可视化操作的无人机飞控设计虚拟仿真平台。软件共有三个主要界面，分别是登录界面，配置界面，实时工作界面。

登录界面主要是让用户确定软件的运行方式。本平台提供两种运行方式,一种为本地运行，即Unreal Engine，AirSim,本软件平台均位于用户主机上，另外一种是远程运行方式，即Unreal Engine,AirSim均位于远端服务器上，本软件平台位于用户主机上。

配置界面主要是让用户选择仿真模型，惯性参数，环境条件以及相机参数等。

实时工作界面主要提供了显示画面，包括多角度的相机画面，各类传感器数据的可视化。同时为用户提供了多种交互控制方式，帮助用户测试飞行。

## 软件操作细节
- **软件启动** : 需要用户具备*Python*环境，只需要运行在SPBA目录下的*main.py*文件，便可以启动本平台。软件的界面相关代码全部位于同目录下的*new_ui*文件夹中，其余的代码是本平台旧版本的相关代码。其中*controller*文件夹下包含了键盘控制以及按钮控制相关代码，*image_resource*文件下是暂存的图片，用于部分画面的显示，*login*文件中主要是登录界面的相关代码，*RPC*文件中主要是RPC通信相关代码，*settings*主要是配置界面的相关代码，*show_data*文件主要是实时工作界面的相关代码。
- **登陆界面** : 目前用户只需要选择远程登录或者本地登录就可以点击登录进入配置界面，用户名与密码暂时未启用。在远程登录的情况下无需配置登录界面中展示的必要文件路径，但需要确保服务器正常运行。在正常情况下，服务器端应该一直处于等待状态，等待接收RPC请求。要使服务器端处于等待状态，需要进行如下配置：首先服务器端需要选择SPBA-Server用户，用户登录密码为*SPBA0217*，进入服务器端，需要在*D:\SPBA\new_ui*目录下启动*RPC_server.py*脚本。若需要更改仿真环境，需要手动将所需环境的路径在*remote_configuration_file.json*文件中进行配置。在本地登陆的情况下，需要配置登录界面中展示的相关文件路径才能确保平台正确启动。
  
  ![login](/figure/login.jpg "本地登录操作流程图")

  如上图，展示了本地登录情况下的必要文件路径配置。在本地登录中需要首先选择本地登录按钮，接着点击下拉框选择需要进行配置的对象，再通过点击菜单按钮选择相应的路径或者直接输入相应路径，完成配置后即可点击登录跳转至配置界面。
- **配置界面** : 配置界面提供了必要的参数调整，直接可以通过鼠标键盘进行修改。
  ![login](/figure/setting.png "配置界面")

  配置界面如上图，其中包括了许多参数，其修改参数的实现两种方式，一种是更改AirSim默认配置文档，另外一种是修改AirSim相关参数的源码。当参数修改达到用户期望时，点击*next*按钮可以进入实时工作界面，也可以点击*back*按钮回到登录界面。

- **实时工作界面** : 实时工作界面提供了多种控制交互方式与仿真画面展示，同时涵盖了许多传感器数据显示。实时工作界面如下图。
  ![login](/figure/work.jpg "实时工作界面")
  对于显示，用户可以通过点击菜单栏窗口切换不同的显示，可以切换相机的视角与传感器的数据显示。对于飞行路径测试，目前提供了两种飞行路径包括O字型和8字型，只需要点击操作即可。对于键盘控制飞行，在点击键盘控制按钮后进入键盘控制模式：*t*控制起飞，在进行其他控制之前需要先进行起飞；*l*控制降落；方向键控制移动；*shift*与其他按键组合使用可以加速飞行，按下*q*键可以退出键盘控制模式。脚本控制模式下，用户可以使用*Python*脚本进行控制。脚本书写方式按照*Python*格式，使用AirSim提供的API进行控制，在对应的脚本输入框内输入代码，然后点击开始按钮便可以进行编译运行，编译结果会反馈在输入框下方的输出框内，用户可以测试自己的飞控算法。用户也可以通过点击*record*按钮进行录制，保存相关仿真画面与传感器数据。

